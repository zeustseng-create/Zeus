<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ZeOnline å¯ç·¨è¼¯+åŸ·è¡Œç¨‹å¼ç¢¼</title>

<!-- CodeMirror 6 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@6.0.1/dist/codemirror.min.css">
<script src="https://cdn.jsdelivr.net/npm/@codemirror/basic-setup"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-python"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-ruby"></script>
<script src="https://cdn.jsdelivr.net/npm/@codemirror/lang-wast"></script>

<!-- Python -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
<!-- Ruby -->
<script src="https://cdn.jsdelivr.net/npm/@ruby/wasm-wasi@latest/dist/browser.umd.js"></script>
<!-- Go WASM helper -->
<script src="wasm_exec.js"></script>

<style>
body { font-family: monospace; background:#0f172a; color:#e5e7eb; padding:20px; }
button, select { padding:6px; margin:5px 0; cursor:pointer; }
#editor { height:250px; border:1px solid #888; }
pre { background:#020617; border:1px solid #334155; padding:10px; min-height:120px; margin-top:10px; white-space:pre-wrap; }
.tip { margin-top:20px; font-size:14px; color:#93c5fd; }
.tip button { margin-left:10px; padding:3px 6px; font-size:12px; }
</style>
</head>
<body>

<h2>ğŸŒ å¤šèªè¨€å‰ç«¯åŸ·è¡Œå™¨ + Go WASM</h2>

JavaScript Python Ruby Assembly (WASM) Go â–¶ åŸ·è¡Œ ä¸‹è¼‰ç¨‹å¼ç¢¼

<!-- ç¨‹å¼ç¢¼å€ -->
<div id="editor"></div>
<pre id="output"></pre>

<!-- æ‰“è³å€ -->
<div class="tip">
ğŸ’– æ‰“è³æ”¯æŒæˆ‘ï¼š<br>
BTC: bc1qrgul4zpppscp0q5gmvx4ugtxpzkd6yulefrjpm <button onclick="copyText('btc')">è¤‡è£½</button><br>
SOL: FfttT4mcpfi6rERqV7ziBoUNCQUEWaeRq4jcTKSgAFbC <button onclick="copyText('sol')">è¤‡è£½</button><br>
Lightning: lnbc1xxxxxxx <button onclick="copyText('ln')">è¤‡è£½</button>
</div>

<select id="lang" onchange="changeLang()">
  <option value="js">JavaScript</option>
  <option value="python">Python</option>
  <option value="ruby">Ruby</option>
  <option value="asm">Assembly (WASM)</option>
  <option value="go">Go WASM</option>
</select>

<button onclick="run()">â–¶ åŸ·è¡Œ</button>
<button onclick="downloadCode()">ğŸ’¾ ä¸‹è¼‰ç¨‹å¼ç¢¼</button>

<script>
let editor, pyodide, goInstance = new Go();

// åˆå§‹åŒ– Pyodide
async function initPy(){ pyodide=await loadPyodide(); }
initPy();

// ç¯„ä¾‹ç¨‹å¼ç¢¼
const examples = {
js:`console.log("Hello JS")`,
python:`print("Hello Python")`,
ruby:`puts "Hello Ruby"`,
asm:`(module (func $run (result i32) i32.const 42) (export "run" (func $run)))`,
go:`package main\nimport "fmt"\nfunc main(){fmt.Println("Hello Go")}`
};

// åˆ‡æ›èªè¨€
function changeLang(){
  const lang=document.getElementById("lang").value;
  let extension;
  switch(lang){
    case "js": extension=javascript(); break;
    case "python": extension=python(); break;
    case "ruby": extension=ruby(); break;
    case "asm": extension=wast(); break;
    case "go": extension=javascript(); break; // é«˜äº®ç”¨ JS
  }

  if(editor) editor.destroy();
  editor = new CodeMirror.EditorView({
    doc: examples[lang],
    extensions:[basicSetup, extension],
    parent:document.getElementById("editor")
  });
  document.getElementById("output").textContent="";
}
changeLang();

// åŸ·è¡Œç¨‹å¼ç¢¼
async function run(){
  const lang=document.getElementById("lang").value;
  const code=editor.state.doc.toString();
  const out=document.getElementById("output");
  out.textContent="";
  const wrapOutput=(text)=>{ out.textContent+=text+"\n"; }

  if(lang==="js"){
    const oldLog=console.log;
    console.log=(...args)=>wrapOutput(args.join(" "));
    try{ new Function(code)(); }catch(e){ wrapOutput(e.message);}
    console.log=oldLog;
  }
  if(lang==="python"){
    try{ await pyodide.runPythonAsync(code); }catch(e){ wrapOutput(e);}
  }
  if(lang==="ruby"){
    const {DefaultRubyVM}=window.RubyWasm;
    const vm=await DefaultRubyVM();
    vm.print=text=>wrapOutput(text);
    vm.eval(code);
  }
  if(lang==="asm"){
    try{
      const bytes=new TextEncoder().encode(code);
      const mod=await WebAssembly.compile(bytes);
      const inst=await WebAssembly.instantiate(mod);
      wrapOutput("çµæœ = "+inst.exports.run());
    }catch(e){ wrapOutput("Assembly éŒ¯èª¤ï¼š"+e.message);}
  }
  if(lang==="go"){
    try{
      const resp = await fetch("main.wasm");
      const buffer = await resp.arrayBuffer();
      const result = await WebAssembly.instantiate(buffer, goInstance.importObject);
      goInstance.run(result.instance);
      wrapOutput("Go ç¨‹å¼åŸ·è¡Œå®Œç•¢ï¼ˆè«‹æŸ¥çœ‹ consoleï¼‰");
    }catch(e){ wrapOutput("Go WASM éŒ¯èª¤ï¼š"+e.message);}
  }
}

// ä¸‹è¼‰ç¨‹å¼ç¢¼
function downloadCode(){
  const lang=document.getElementById("lang").value;
  const code=editor.state.doc.toString();
  let ext;
  switch(lang){ case "js":ext=".js"; break; case "python":ext=".py"; break; case "ruby":ext=".rb"; break; case "asm":ext=".wat"; break; case "go":ext=".go"; break;}
  const blob=new Blob([code],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="code"+ext;
  a.click();
}

// æ‰“è³è¤‡è£½
function copyText(id){
  let text="";
  if(id==="btc") text="bc1qrgul4zpppscp0q5gmvx4ugtxpzkd6yulefrjpm";
  if(id==="sol") text="FfttT4mcpfi6rERqV7ziBoUNCQUEWaeRq4jcTKSgAFbC";
  if(id==="ln") text="lnbc1xxxxxxx";
  navigator.clipboard.writeText(text);
  alert("å·²è¤‡è£½: "+text);
}
</script>

</body>
</html>
