<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>經典 Pacman 單檔版 - 直接開就玩</title>
<style>
    body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; image-rendering:pixelated; }
    canvas { border:5px solid #00ffff; box-shadow:0 0 30px #00ffff; }
    #score { position:absolute; top:10px; left:10px; color:#fff; font: bold 24px Arial; text-shadow:0 0 10px #00ffff; }
    #lives { position:absolute; top:10px; right:10px; color:#fff; font: bold 24px Arial; text-shadow:0 0 10px #00ffff; }
    #start-screen, #game-over { position:absolute; width:100%; height:100%; background:rgba(0,0,0,0.8); color:#ff0; font: bold 48px Arial; display:flex; flex-direction:column; justify-content:center; align-items:center; justify-content:center; }
    button { margin-top:30px; padding:15px 40px; font-size:28px; background:#ff0; color:#000; border:none; border-radius:10px; cursor:pointer; }
    button:hover { background:#ff0; box-shadow:0 0 20px #ff0; }
</style>
</head>
<body>

<div id="score">分數: 0</div>
<div id="lives">❤❤❤</div>

<canvas id="canvas" width="448" height="496"></canvas>

<div id="start-screen">
    <div>PACMAN</div>
    <button onclick="startGame()">開始遊戲</button>
    <div style="margin-top:50px; font-size:24px;">方向鍵或 WASD 移動</div>
</div>

<div id="game-over" style="display:none;">
    <div>GAME OVER</div>
    <div style="font-size:36px; margin:20px;">最終分數: <span id="final-score">0</span></div>
    <button onclick="location.reload()">再來一局</button>
</div>

<script>
// 超簡化但超好玩的 Pacman（448×496 像素經典尺寸）
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const TILE = 16;

const map = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],
  [1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1],
  [1,3,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,1,1,1,3,1],
  [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
  [1,2,1,1,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,1,2,1],
  [1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1],
  [1,1,1,1,1,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,2,1,1,1,1,1],
  [0,0,0,0,0,1,2,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,2,1,0,0,0,0],
  [1,1,1,1,1,1,2,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,1,1],
  [1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],
  [1,1,1,1,1,1,2,1,1,0,1,0,0,0,0,0,0,1,0,1,1,2,1,1,1,1,1,1],
  [0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0],
  [1,1,1,1,1,1,2,1,1,0,1,0,0,0,0,0,0,1,0,1,1,2,1,1,1,1,1,1],
  [1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],
  [1,1,1,1,1,1,2,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,1,1],
  [0,0,0,0,0,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,0,0,0,0],
  [1,1,1,1,1,1,2,1,1,0,1,1,1,1,1,1,1,1,0,1,1,2,1,1,1,1,1,1],
  [1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1],
  [1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1],
  [1,2,2,1,1,2,2,1,1,2,2,2,2,1,1,2,2,2,2,1,1,2,2,1,1,2,2,1],
  [1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1],
  [1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
  [1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1],
  [1,3,2,2,1,1,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,1,1,2,2,3,1],
  [1,1,1,2,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,1],
  [1,2,2,2,2,2,2,1,1,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1],
  [1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1],
  [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let pacman = { x:14, y:23, dir:0, nextDir:0, mouth:0 };
let ghosts = [
    {x:13, y:11, dir:2, color:'#f00', mode:'chase'}, // 紅
    {x:13, y:14, dir:1, color:'#ffb8ff', mode:'chase'}, // 粉
    {x:15, y:14, dir:3, color:'#00ffff', mode:'chase'}, // 青
    {x:11, y:14, dir:0, color:'#ffb851', mode:'chase'}  // 橘
];
let score = 0;
let lives = 3;
let dots = 0;
let powerMode = 0;
let gameRunning = false;

const dirs = [[1,0],[0,-1],[-1,0],[0,1]]; // 右上左下

function drawMap() {
    for(let y=0; y<map.length; y++){
        for(let x=0; x<map[y].length; x++){
            let v = map[y][x];
            if(v===1){
                ctx.fillStyle = '#00f';
                ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
            } else if(v===2 || v===3){
                ctx.fillStyle = v===3 ? '#f00' : '#fff';
                ctx.beginPath();
                ctx.arc(x*TILE/2 + x*TILE, TILE/2 + y*TILE, v===3?6:2, 0, Math.PI*2);
                ctx.fill();
            }
        }
    }
}

function drawPacman() {
    let angle = pacman.mouth ? 0.2 : 0.05;
    ctx.fillStyle = '#ff0';
    ctx.beginPath();
    ctx.arc(pacman.x*TILE + TILE/2, pacman.y*TILE + TILE/2, TILE/2 * 0.9, 
            angle*Math.PI - pacman.dir*Math.PI/2, (2-angle)*Math.PI - pacman.dir*Math.PI/2);
    ctx.lineTo(pacman.x*TILE + TILE/2, pacman.y*TILE + TILE/2);
    ctx.fill();
}

function drawGhosts() {
    ghosts.forEach(g=>{
        ctx.fillStyle = powerMode>0 ? '#00f' : g.color;
        // 鬼身體
        ctx.beginPath();
        ctx.arc(g.x*TILE + TILE/2, g.y*TILE + TILE/2, TILE/2, Math.PI, 0, false);
        ctx.lineTo(g.x*TILE + TILE, g.y*TILE + TILE);
        ctx.lineTo(g.x*TILE + TILE*0.75, g.y*TILE + TILE*0.7);
        ctx.lineTo(g.x*TILE + TILE*0.5, g.y*TILE + TILE);
        ctx.lineTo(g.x*TILE + TILE*0.25, g.y*TILE + TILE*0.7);
        ctx.lineTo(g.x*TILE, g.y*TILE + TILE);
        ctx.lineTo(g.x*TILE, g.y*TILE + TILE/2);
        ctx.fill();
        // 眼睛
        ctx.fillStyle = '#fff';
        ctx.beginPath(); ctx.arc(g.x*TILE + TILE*0.35, g.y*TILE + TILE*0.4, TILE*0.15,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(g.x*TILE + TILE*0.65, g.y*TILE + TILE*0.4, TILE*0.15,0,Math.PI*2); ctx.fill();
        ctx.fillStyle = '#00f';
        ctx.beginPath(); ctx.arc(g.x*TILE + TILE*0.35 + g.dir%2*3, g.y*TILE + TILE*0.4, TILE*0.07,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(g.x*TILE + TILE*0.65 + g.dir%2*3, g.y*TILE + TILE*0.4, TILE*0.07,0,Math.PI*2); ctx.fill();
    });
}

function move() {
    // Pacman 移動
    if(pacman.dir !== pacman.nextDir){
        let [dx,dy] = dirs[pacman.nextDir];
        if(map[pacman.y+dy] && map[pacman.y+dy][pacman.x+dx] !== 1) pacman.dir = pacman.nextDir;
    }
    let [dx,dy] = dirs[pacman.dir];
    if(map[pacman.y+dy] && map[pacman.y+dy][pacman.x+dx] !== 1){
        pacman.x += dx; pacman.y += dy;
        if(pacman.x < 0) pacman.x = 27;
        if(pacman.x > 27) pacman.x = 0;
    }

    // 吃豆
    if(map[pacman.y][pacman.x] === 2){
        map[pacman.y][pacman.x] = 0;
        score += 10;
        dots--;
    }
    if(map[pacman.y][pacman.x] === 3){
        map[pacman.y][pacman.x] = 0;
        score += 50;
        powerMode = 400; // 約8秒
    }

    // 鬼移動（超簡AI）
    ghosts.forEach(g=>{
        if(Math.random()<0.05 || map[g.y + dirs[g.dir][1]]?.[g.x + dirs[g.dir][0]] === 1){
            let possible = dirs.map((d,i)=> ({d,i})).filter(({d})=> map[g.y+d[1]]?.[g.x+d[0]] !== 1);
            let choice = possible[Math.floor(Math.random()*possible.length)];
            g.dir = choice.i;
        }
        g.x += dirs[g.dir][0];
        g.y += dirs[g.dir][1];
        if(g.x < 0) g.x = 27;
        if(g.x > 27) g.x = 0;
    });

    // 碰撞檢測
    ghosts.forEach(g=>{
        if(Math.abs(g.x - pacman.x)<0.8 && Math.abs(g.y - pacman.y)<0.8){
            if(powerMode>0){
                score += 200;
                g.x = 13; g.y = 14; // 回老家
            } else {
                lives--;
                document.getElementById('lives').innerHTML = '❤'.repeat(lives);
                pacman.x=14; pacman.y=23;
                if(lives<=0) gameOver();
            }
        }
    });

    if(powerMode>0) powerMode--;
    if(dots===0) { alert('你太強了！全圖吃光！'); location.reload(); }

    pacman.mouth = !pacman.mouth;
}

function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawMap();
    drawGhosts();
    drawPacman();
    document.getElementById('score').innerHTML = '分數: ' + score;
    if(gameRunning) move();
    requestAnimationFrame(loop);
}

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    gameRunning = true;
    // 計算總豆子數
    map.forEach(row=>row.forEach(v=>{if(v===2||v===3) dots++;}));
}

// 鍵盤控制
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowRight' || e.key==='d') pacman.nextDir = 0;
    if(e.key==='ArrowUp'    || e.key==='w') pacman.nextDir = 1;
    if(e.key==='ArrowLeft'  || e.key==='a') pacman.nextDir = 2;
    if(e.key==='ArrowDown'  || e.key==='s') pacman.nextDir = 3;
});

// 手機觸控（滑動方向）
let touchStartX, touchStartY;
canvas.addEventListener('touchstart', e=>{
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
    e.preventDefault();
}, {passive:false});
canvas.addEventListener('touchmove', e=>{
    if(!touchStartX) return;
    let dx = e.touches[0].clientX - touchStartX;
    let dy = e.touches[0].clientY - touchStartY;
    if(Math.abs(dx)>30 || Math.abs(dy)>30){
        if(Math.abs(dx)>Math.abs(dy)){
            pacman.nextDir = dx>0 ? 0 : 2;
        } else {
            pacman.nextDir = dy>0 ? 3 : 1;
        }
        touchStartX = null;
    }
    e.preventDefault();
}, {passive:false});

function gameOver() {
    gameRunning = false;
    document.getElementById('final-score').innerHTML = score;
    document.getElementById('game-over').style.display = 'flex';
}

loop();
</script>
</body>
</html>
