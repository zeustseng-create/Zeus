<html>
  <head>
    <title>Zeus聊天室</title>
  </head>

  <body>
    <button onclick="show()" style="width:140px;height:140px;font-size:30px;">
      查詢
    </button>

    <button onclick="sho()" style="width:140px;height:140px;font-size:30px;">
      傳送
    </button>

    <br><br>
    <pre id="aal"></pre>

    <script>
      let ss = null;
      const a = "https://de9a4be2-0cf2-4d3d-8518-05efa504bed5-00-heqz1qejfaam.pike.replit.dev/";

      // 正確的錯誤處理方式：fetch + catch
      fetch(a)
        .then(res => res.json())
        .then(data => {
          ss = data;
          console.log("資料載入完成", ss);
        })
        .catch(() => {
          alert("server掛了 聯絡Zeus");
        });

      function show() {
        if (!ss) {
          alert("資料尚未載入完成");
          return;
        }

        let y = "";

        for (let i = 0; i < ss["message"][0].length; i++) {
          y += ss["message"][1][i] + ": ";
          y += ss["message"][0][i] + "\n";
        }

        document.getElementById("aal").textContent = y;
      }

      function sho() {
        const p = prompt("輸入名稱");
        const h = prompt("輸入訊息");
        let ll=ss;
        ll["message"][1].push(p);
        ll["message"][0].push(h);
        fetch(
          a +
          "1234/" +
          encodeURIComponent(ll) +
          "/" +
          encodeURIComponent(p) +
          "/"
        )
        .then(() => alert("已送出"))
        .catch(() => alert("server掛了 聯絡Zeus"));
      }
    </script>
  </body>
</html>
