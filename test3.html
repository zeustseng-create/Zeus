<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Zeus 聊天室</title>
  </head>

  <body>
    <button onclick="show()" style="width:140px;height:140px;font-size:30px;">
      查詢
    </button>

    <button onclick="sho()" style="width:140px;height:140px;font-size:30px;">
      傳送
    </button>

    <br><br>
    <pre id="aal"></pre>

    <script>
      // ===== 基本設定 =====
      const API =
        "https://de9a4be2-0cf2-4d3d-8518-05efa504bed5-00-heqz1qejfaam.pike.replit.dev/";

      // ===== 顯示聊天室 =====
      function show() {
        fetch(API)
          .then(res => res.json())
          .then(ss => {
            let y = "";

            // ss.message[0] = 訊息
            // ss.message[1] = 名稱
            for (let i = 0; i < ss.message[0].length; i++) {
              y += ss.message[1][i] + ": ";
              y += ss.message[0][i] + "\n";
            }

            document.getElementById("aal").textContent = y;
          })
          .catch(() => {
            alert("server 掛了，聯絡 Zeus");
          });
      }

      // ===== 傳送訊息（照 server 要求：整包 ss） =====
      function sho() {
        fetch(API)
          .then(res => res.json())
          .then(ss => {
            const p = prompt("輸入名稱");
            if (!p) return;

            const h = prompt("輸入訊息");
            if (!h) return;

            // ✅ 照你說的：直接改整包資料
            ss.message[1].push(p);
            ss.message[0].push(h);

            // ✅ 關鍵修正：物件 → JSON → URL encode
            const payload = encodeURIComponent(JSON.stringify(ss));

            return fetch(API + "1234/" + payload + "/");
          })
          .then(() => {
            alert("已送出");
            show(); // 傳送完直接刷新
          })
          .catch(() => {
            alert("server 掛了，聯絡 Zeus");
          });
      }

      // 頁面一開先顯示一次
      show();
    </script>
  </body>
</html>
