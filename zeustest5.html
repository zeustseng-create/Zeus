<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ‰“å­—è§¸ç™¼ 10 Hz æ¬¡éŸ³æ³¢</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans TC', 'Microsoft JhengHei', sans-serif; padding: 24px; background:#f7fafc; color:#0f172a; }
    .card { background:white; border-radius:12px; box-shadow:0 6px 18px rgba(15,23,42,0.08); padding:18px; max-width:760px; margin:16px auto; }
    h1{ font-size:20px; margin:0 0 8px }
    p{ margin:8px 0 }
    .controls{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:12px }
    button{ padding:8px 12px; border-radius:8px; border:1px solid #e2e8f0; background:#fff; cursor:pointer }
    button.primary{ background:#0ea5a4; color:white; border:none }
    .status{ font-size:13px; color:#475569 }
    textarea{ width:100%; height:160px; margin-top:12px; padding:10px; border-radius:8px; border:1px solid #e2e8f0; resize:vertical }
    small.warn{ color:#b91c1c }
    .slider-container { display:flex; align-items:center; gap:8px; margin-top:10px; }
    .slider-container label { font-size:14px; color:#475569; }
    #modeStatus { font-weight:bold; }
  </style>
</head>
<body>
  <div class="card">
    <h1>æ‰“å­—æ™‚ç™¼å‡º 10 Hz æ¬¡éŸ³æ³¢ï¼ˆå¯¦éš›æ’­æ”¾ï¼‰</h1>
    <p>èªªæ˜ï¼šæ­¤é é¢æœƒåœ¨ä½ æŒ‰éµæ™‚æ’­æ”¾ <strong>10 Hz</strong> çš„ä½é »æ­£å¼¦æ³¢ï¼ˆæ¬¡éŸ³æ³¢ï¼‰ã€‚
      ç”±æ–¼äººè€³é€šå¸¸è½ä¸åˆ°ä½æ–¼ 20 Hz çš„è²éŸ³ï¼Œè€Œä¸”å¤šæ•¸å–‡å­ç„¡æ³•æœ‰æ•ˆé‡ç¾ 10 Hzï¼Œæ’­æ”¾æ•ˆæœå¯èƒ½æ˜¯éœ‡å‹•æˆ–æ ¹æœ¬ç„¡è²ã€‚</p>
    <p class="status">ç‹€æ…‹ï¼š<span id="ctxState">AudioContext å°šæœªå•Ÿå‹•</span></p>

    <div class="controls">
      <button id="btnEnable" class="primary">å•Ÿå‹•éŸ³è¨Šï¼ˆéœ€è¦ä½¿ç”¨è€…äº’å‹•ï¼‰</button>
      <button id="btnToggleVisual">åˆ‡æ›è¦–è¦ºåé¥‹</button>
      <button id="btnToggleMode">åˆ‡æ›æ¨¡å¼ï¼ˆç›®å‰ï¼šå®‰å…¨ï¼‰</button>
    </div>

    <div class="slider-container">
      <label for="volume">éŸ³é‡ï¼ˆdBï¼‰ï¼š</label>
      <input id="volume" type="range" min="-40" max="60" step="1" value="-26" />
      <span id="volValue">-26 dB</span>
    </div>

    <div class="slider-container">
      <label for="duration">æ¯æ¬¡æŒ‰éµæŒçºŒæ™‚é–“ï¼ˆmsï¼‰ï¼š</label>
      <input id="duration" type="range" min="10" max="20000" step="1" value="150" />
      <span id="durationValue">150 ms</span>
    </div>

    <p id="modeStatus" style="color:#0f766e">ğŸ”’ ç›®å‰ç‚ºå®‰å…¨æ¨¡å¼</p>
    <p id="modeWarning" style="color:#b91c1c; display:none;">âš ï¸ çœŸå¯¦æ¨¡å¼å¯èƒ½é€ æˆå¤±çœŸæˆ–æå£å–‡å­ï¼Œè«‹è¬¹æ…ä½¿ç”¨ï¼</p>

    <p><small class="warn">æ³¨æ„ï¼šè«‹å‹¿åœ¨éŸ³é‡éå¤§æˆ–é è¿‘æ•æ„Ÿè¨­å‚™æ™‚é•·æ™‚é–“æ’­æ”¾ã€‚æŸäº›å°å‹å–‡å­æˆ–è€³æ©Ÿç„¡æ³•ç™¼å‡ºæ­¤é »ç‡ï¼Œæ’­æ”¾å¯èƒ½å°è‡´å¤±çœŸæˆ–ç¡¬é«”ç•°å¸¸ã€‚ä½ è‡ªè¡Œæ‰¿æ“”ä½¿ç”¨é¢¨éšªã€‚</small></p>

    <textarea id="text" placeholder="åœ¨æ­¤è¼¸å…¥æ–‡å­—ï¼ŒæŒ‰éµæ™‚æœƒç™¼å‡º 10 Hz æ¬¡éŸ³æ³¢ï¼ˆè«‹å…ˆæŒ‰ã€å•Ÿå‹•éŸ³è¨Šã€ï¼‰"></textarea>

    <p style="margin-top:12px">åƒæ•¸ï¼šé »ç‡ = <strong>10 Hz</strong>ï¼›æ³¢å½¢ = æ­£å¼¦æ³¢ã€‚</p>
  </div>

  <script>
    let audioCtx = null;
    const freq = 10;
    let keyDuration = 0.15;
    let safeMode = true;

    const btnEnable = document.getElementById('btnEnable');
    const btnToggleVisual = document.getElementById('btnToggleVisual');
    const btnToggleMode = document.getElementById('btnToggleMode');
    const ctxStateSpan = document.getElementById('ctxState');
    const volumeSlider = document.getElementById('volume');
    const volValue = document.getElementById('volValue');
    const durationSlider = document.getElementById('duration');
    const durationValue = document.getElementById('durationValue');
    const textarea = document.getElementById('text');
    const modeStatus = document.getElementById('modeStatus');
    const modeWarning = document.getElementById('modeWarning');

    let visualOn = true;

    btnEnable.addEventListener('click', async () => {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') await audioCtx.resume();
      ctxStateSpan.textContent = 'AudioContext å·²å•Ÿå‹•ï¼ˆ' + audioCtx.state + 'ï¼‰';
      btnEnable.disabled = true;
    });

    btnToggleVisual.addEventListener('click', () => {
      visualOn = !visualOn;
      btnToggleVisual.textContent = visualOn ? 'åˆ‡æ›è¦–è¦ºåé¥‹' : 'åˆ‡æ›è¦–è¦ºåé¥‹ (é—œ)';
    });

    btnToggleMode.addEventListener('click', () => {
      safeMode = !safeMode;
      if (safeMode) {
        btnToggleMode.textContent = 'åˆ‡æ›æ¨¡å¼ï¼ˆç›®å‰ï¼šå®‰å…¨ï¼‰';
        modeStatus.textContent = 'ğŸ”’ ç›®å‰ç‚ºå®‰å…¨æ¨¡å¼';
        modeStatus.style.color = '#0f766e';
        modeWarning.style.display = 'none';
      } else {
        btnToggleMode.textContent = 'åˆ‡æ›æ¨¡å¼ï¼ˆç›®å‰ï¼šçœŸå¯¦ï¼‰';
        modeStatus.textContent = 'âš¡ ç›®å‰ç‚ºçœŸå¯¦æ¨¡å¼';
        modeStatus.style.color = '#b91c1c';
        modeWarning.style.display = 'block';
      }
    });

    volumeSlider.addEventListener('input', () => {
      volValue.textContent = volumeSlider.value + ' dB';
    });

    durationSlider.addEventListener('input', () => {
      durationValue.textContent = durationSlider.value + ' ms';
      keyDuration = parseInt(durationSlider.value) / 1000;
    });

    function dbToGain(db, safe) {
      let gainValue = Math.pow(10, db / 20);
      if (safe && gainValue > 1) gainValue = 1;
      if (gainValue < 0.0001) gainValue = 0.0001;
      return gainValue;
    }

    function play10HzOnce() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, now);

      const gain = audioCtx.createGain();
      const gainValue = dbToGain(parseFloat(volumeSlider.value), safeMode);
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(gainValue, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + keyDuration);

      osc.connect(gain).connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now + keyDuration + 0.02);

      if (visualOn) flashTextarea(keyDuration * 1000);
    }

    function flashTextarea(ms) {
      const original = textarea.style.boxShadow;
      textarea.style.boxShadow = '0 0 0 6px rgba(14,165,164,0.12)';
      setTimeout(() => { textarea.style.boxShadow = original; }, ms);
    }

    let keysDown = new Set();
    window.addEventListener('keydown', (e) => {
      if (!audioCtx) return;
      const k = e.code || e.key;
      if (keysDown.has(k)) return;
      keysDown.add(k);
      play10HzOnce();
    });
    window.addEventListener('keyup', (e) => {
      const k = e.code || e.key;
      keysDown.delete(k);
    });

    textarea.addEventListener('input', () => {
      if (!audioCtx) return;
      play10HzOnce();
    });

    function userGestureInit() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      ctxStateSpan.textContent = 'AudioContext å·²å•Ÿå‹•ï¼ˆ' + audioCtx.state + 'ï¼‰';
      btnEnable.disabled = true;
      window.removeEventListener('keydown', userGestureInit);
      window.removeEventListener('pointerdown', userGestureInit);
    }
    window.addEventListener('pointerdown', userGestureInit);
    window.addEventListener('keydown', userGestureInit);
  </script>
</body>
</html>
